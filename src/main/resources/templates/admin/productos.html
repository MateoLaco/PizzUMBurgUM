<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">

<head>
    <title>Gesti√≥n de Productos - Admin</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary-color:#dc3545; --secondary-color:#ffc107; --dark-color:#2c3e50; --light-color:#f8f9fa; }

        body { font-family:'Poppins',sans-serif; background:var(--dark-color); margin:0; }

        .navbar-horizontal{ background:var(--dark-color); padding:1rem 0; box-shadow:0 4px 20px rgba(0,0,0,.1); }
        .nav-container{ display:flex; justify-content:space-between; align-items:center;}
        .navbar-brand{ font-family:'Montserrat';margin-left: 2rem; font-weight:700; color:white !important; font-size:1.8rem; text-decoration:none; }
        .nav-links{ display:flex; gap:10px; }
        .nav-link{ padding:10px 20px; border-radius:25px; color:white; text-decoration:none; }
        .nav-link.active{ background:var(--primary-color); }
        .logout-btn{ border:2px solid #fff; border-radius:25px; }

        /* HERO */
        .hero-section{ padding:90px 0; text-align:center; color:white;
            background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
            url('https://images.unsplash.com/photo-1604908176997-125188b8d518?q=80&auto=format&fit=crop');
            background-size:cover; background-position:center;
        }
        .hero-title{ font-size:2.6rem; font-weight:700; margin-bottom:.3rem;}
        .hero-subtitle{ font-size:1.1rem; max-width:650px; margin:auto; }

        /* CONTENT */
        .page-section{ background:#f8f9fa; padding:50px 0; }
        .card{ background:white; padding:20px 25px; border-radius:15px; margin-bottom:25px;
            box-shadow:0 10px 25px rgba(0,0,0,.08);
        }
        .card h3{ margin:0 0 15px 0; font-size:1.3rem; }

        /* FORM NUEVO PRODUCTO */
        .form-grid{
            display:grid;
            grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
            gap:20px;
        }

        .form-group label{
            font-weight:600;
            margin-bottom:6px;
            display:block;
        }
        .form-group input,
        .form-group select{
            width:100%;
            padding:10px 12px;
            border-radius:10px;
            border:1px solid #dcdcdc;
            font-size:.95rem;
        }

        /* CUSTOM CHECKBOX */
        .checkbox-wrapper{
            display:flex;
            align-items:center;
            gap:8px;
            margin-top:4px;
        }

        .checkbox-wrapper input[type="checkbox"]{
            appearance:none;
            width:20px; height:20px;
            border:2px solid var(--primary-color);
            border-radius:5px;
            cursor:pointer;
            position:relative;
            background:#fff;
        }
        .checkbox-wrapper input[type="checkbox"]:checked{
            background:var(--primary-color);
        }
        .checkbox-wrapper input[type="checkbox"]:checked::after{
            content:"‚úî";
            color:white;
            font-size:14px;
            position:absolute;
            left:3px;
            top:-1px;
        }

        /* BUTTONS */
        .btn-primary{
            background:linear-gradient(45deg,#dc3545,#c82333);
            border:none;
            padding:10px 20px;
            border-radius:14px;
            color:white;
            font-weight:600;
            cursor:pointer;
            font-size:.95rem;
        }
        .btn-primary:hover{
            transform:translateY(-2px);
            box-shadow:0 8px 20px rgba(220,53,69,.3);
        }

        .btn-small{
            padding:8px 16px;
            border-radius:10px;
            border:none;
            background:#2c3e50;
            color:white;
            cursor:pointer;
            font-weight:600;
            font-size:.9rem;
        }
        .btn-small:hover{
            background:#dc3545;
        }

        /* TABLE */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 14px;
            border-bottom: 1px solid #e9e9e9;
            font-size: .95rem;
        }

        table th, table td {
            text-align: center !important;
            vertical-align: middle;
        }


        .badge{
            padding:5px 10px;
            border-radius:12px;
            font-size:.8rem;
            font-weight:600;
        }
        .badge-true{ background:#d4edda; color:#155724; }
        .badge-false{ background:#f8d7da; color:#721c24; }

        .alert{ border-radius:10px; padding:10px 14px; font-size:.9rem; margin-bottom:15px;}
        .alert-success{ background:#d4edda; color:#155724; border:1px solid #c3e6cb;}
        .alert-danger{ background:#f8d7da; color:#721c24; border:1px solid #f5c6cb;}
    </style>
</head>

<body>

<div layout:fragment="content">

    <!-- NAVBAR -->
    <nav class="navbar-horizontal">
        <div class="container nav-container">
            <a href="/admin/panel" class="navbar-brand">PizzUM & BurgUM</a>

            <div class="nav-links">
                <a class="nav-link" href="/admin/panel">Inicio</a>
                <a class="nav-link active" href="/admin/productos">Productos</a>
                <a class="nav-link" href="/admin/pedidos">Pedidos</a>
                <a class="nav-link" href="/admin/usuarios">Usuarios</a>
                <a class="nav-link" href="/admin/perfil">Perfil</a>
                <a class="nav-link logout-btn" th:href="@{/auth/logout}">Salir</a>
            </div>
        </div>
    </nav>

    <!-- HERO -->
    <section class="hero-section">
        <div class="container">
            <h1 class="hero-title">Gesti√≥n de Productos</h1>
            <p class="hero-subtitle">Cre√° productos y administr√° su disponibilidad en el men√∫.</p>
        </div>
    </section>

    <!-- MAIN CONTENT -->
    <section class="page-section">
        <div class="container">

            <!-- Mensajes -->
            <div th:if="${mensajeExito}" class="alert alert-success" th:text="${mensajeExito}"></div>
            <div th:if="${mensajeError}" class="alert alert-danger" th:text="${mensajeError}"></div>

            <!-- FORM CREAR PRODUCTO -->
            <div class="card">
                <h3>Nuevo producto</h3>

                <form th:action="@{/admin/productos}" th:object="${productoNuevo}" method="post">
                    <div class="form-grid">

                        <div class="form-group">
                            <label for="nombre">Nombre</label>
                            <input id="nombre" th:field="*{nombre}" placeholder="Ej: Pizza Napolitana">
                        </div>

                        <div class="form-group">
                            <label for="precio">Precio (UYU)</label>
                            <input id="precio" type="number" min="0" th:field="*{precio}">
                        </div>

                        <div class="form-group">
                            <label for="tipo">Tipo</label>
                            <select id="tipo" th:field="*{tipo}">
                                <option value="" disabled selected>Seleccionar</option>
                                <!-- üëá S√≥lo Pizza y Hamburguesa -->
                                <option value="P">Pizza</option>
                                <option value="H">Hamburguesa</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Activo</label>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" th:field="*{activo}">
                                <span>Producto activo</span>
                            </div>
                        </div>

                    </div>

                    <br>
                    <button type="submit" class="btn-primary">Crear producto</button>
                </form>
            </div>

            <!-- TABLA PRODUCTOS -->
            <div class="card">
                <h3>Listado de productos</h3>

                <!-- üî• Un solo formulario para TODA la tabla -->
                <form th:action="@{/admin/productos/actualizar-activos}" method="post">

                    <div class="table-responsive">
                        <table>
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Precio</th>
                                <th>Tipo</th>
                                <th>Activo</th>
                            </tr>
                            </thead>

                            <tbody>
                            <tr th:each="p : ${productos}">
                                <td th:text="${p.id_producto}"></td>
                                <td th:text="${p.nombre}"></td>
                                <td th:text="${p.precio}"></td>
                                <td th:text="${p.tipo}"></td>

                                <td>
                                    <div class="checkbox-wrapper">
                                        <!-- üëá name = 'activos', value = id -->
                                        <input type="checkbox"
                                               name="activos"
                                               th:value="${p.id_producto}"
                                               th:checked="${p.activo}">
                                        <span th:text="${p.activo} ? 'Activo' : 'Inactivo'"></span>
                                    </div>
                                </td>
                            </tr>

                            <tr th:if="${#lists.isEmpty(productos)}">
                                <td colspan="5" style="text-align:center; padding:18px;">
                                    No hay productos cargados.
                                </td>
                            </tr>

                            </tbody>
                        </table>
                    </div>

                    <br>
                    <button type="submit" class="btn-small">Guardar cambios</button>

                </form>
            </div>

        </div>
    </section>

</div>

</body>
</html>
