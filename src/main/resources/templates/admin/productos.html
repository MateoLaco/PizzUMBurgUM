<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">

<head>
    <title>Gesti칩n de Productos - Admin</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary-color:#dc3545; --secondary-color:#ffc107; --dark-color:#2c3e50; --light-color:#f8f9fa; }

        body { font-family:'Poppins',sans-serif; background:var(--dark-color); margin:0; }

        .navbar-horizontal{
            background:var(--dark-color);
            padding:1rem 0;
            box-shadow:0 4px 20px rgba(0,0,0,.1);
        }
        .nav-container{
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .navbar-brand{
            font-family:'Montserrat';
            font-weight:700;
            margin-left: 2rem;
            color:white !important;
            font-size:1.8rem;
            text-decoration:none;
        }
        .nav-links{ display:flex; gap:10px; }
        .nav-link{
            padding:10px 20px;
            border-radius:25px;
            color:white;
            text-decoration:none;
            font-weight:500;
        }
        .nav-link.active{ background:var(--primary-color); }
        .logout-btn{ border:2px solid #fff; border-radius:25px; }

        /* HERO */
        .hero-section{
            padding:90px 0;
            text-align:center;
            color:white;
            background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
            url('https://images.unsplash.com/photo-1514933651103-005eec06c04b?q=80&auto=format&fit=crop');
            background-size:cover;
            background-position:center;
        }
        .hero-title{
            font-size:2.6rem;
            font-weight:700;
            margin-bottom:.3rem;
        }
        .hero-subtitle{
            font-size:1.1rem;
            max-width:650px;
            margin:auto;
        }

        /* CONTENT */
        .page-section{
            background:#f8f9fa;
            padding:50px 0;
        }
        .card{
            background:white;
            padding:20px 25px;
            border-radius:15px;
            margin-bottom:25px;
            box-shadow:0 10px 25px rgba(0,0,0,.08);
        }
        .card h3{
            margin:0 0 15px 0;
            font-size:1.3rem;
        }

        /* FORM PRODUCTO */
        .form-grid{
            display:grid;
            grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
            gap:20px;
        }

        .form-group label{
            font-weight:600;
            margin-bottom:6px;
            display:block;
        }
        .form-group input,
        .form-group select{
            width:100%;
            padding:10px 12px;
            border-radius:10px;
            border:1px solid #dcdcdc;
            font-size:.95rem;
        }

        /* BUTTONS */
        .btn-primary{
            background:linear-gradient(45deg,#dc3545,#c82333);
            border:none;
            padding:10px 20px;
            border-radius:14px;
            color:white;
            font-weight:600;
            cursor:pointer;
            font-size:.95rem;
        }
        .btn-primary:hover{
            transform:translateY(-2px);
            box-shadow:0 8px 20px rgba(220,53,69,.3);
        }

        /* TABLE */
        table{
            width:100%;
            border-collapse:collapse;
        }
        th,td{
            padding:12px 14px;
            border-bottom:1px solid #e9e9e9;
            font-size:.95rem;
        }
        table th, table td{
            text-align:center !important;
            vertical-align:middle;
        }
        th{
            background:#fafafa;
            font-weight:600;
        }

        .badge-tipo{
            padding:5px 10px;
            border-radius:12px;
            font-size:.8rem;
            font-weight:600;
            display:inline-block;
        }
        .badge-H{ background:#ffe5e5; color:#a10f0f; }
        .badge-P{ background:#e5f5ff; color:#0f4fa1; }
        .badge-B{ background:#e8f5e9; color:#1b5e20; }
        .badge-AC{ background:#fff3e0; color:#ef6c00; }
        .badge-O{ background:#e2e3e5; color:#383d41; }

        /* SWITCH */
        .switch{
            position:relative;
            display:inline-block;
            width:46px;
            height:24px;
        }
        .switch input{
            opacity:0;
            width:0;
            height:0;
        }
        .slider{
            position:absolute;
            cursor:pointer;
            top:0; left:0; right:0; bottom:0;
            background-color:#ccc;
            transition:.2s;
            border-radius:34px;
        }
        .slider:before{
            position:absolute;
            content:"";
            height:18px;
            width:18px;
            left:3px;
            bottom:3px;
            background-color:white;
            transition:.2s;
            border-radius:50%;
        }
        input:checked + .slider{
            background-color:#28a745;
        }
        input:checked + .slider:before{
            transform:translateX(22px);
        }

        .alert{
            border-radius:10px;
            padding:10px 14px;
            font-size:.9rem;
            margin-bottom:15px;
        }
        .alert-success{
            background:#d4edda;
            color:#155724;
            border:1px solid #c3e6cb;
        }
        .alert-danger{
            background:#f8d7da;
            color:#721c24;
            border:1px solid #f5c6cb;
        }

        .footer{
            background:var(--dark-color);
            color:#fff;
            padding:30px 0;
            text-align:center;
            margin-top:30px;
        }
    </style>
</head>

<body>

<div layout:fragment="content">

    <!-- NAVBAR -->
    <nav class="navbar-horizontal">
        <div class="container nav-container">
            <a href="/admin/panel" class="navbar-brand">PizzUM & BurgUM</a>

            <div class="nav-links">
                <a class="nav-link" href="/admin/panel">Inicio</a>
                <a class="nav-link active" href="/admin/productos">Productos</a>
                <a class="nav-link" href="/admin/pedidos">Pedidos</a>
                <a class="nav-link" href="/admin/usuarios">Usuarios</a>
                <a class="nav-link" href="/admin/perfil">Perfil</a>
                <a class="nav-link logout-btn" th:href="@{/auth/logout}">Salir</a>
            </div>
        </div>
    </nav>

    <!-- HERO -->
    <section class="hero-section">
        <div class="container">
            <h1 class="hero-title">Gesti칩n de Productos</h1>
            <p class="hero-subtitle">
                Crea, activa/desactiva y ajusta los precios de todos los productos del men칰.
            </p>
        </div>
    </section>

    <!-- MAIN CONTENT -->
    <section class="page-section">
        <div class="container">

            <!-- Mensajes -->
            <div th:if="${mensajeExito}" class="alert alert-success" th:text="${mensajeExito}"></div>
            <div th:if="${mensajeError}" class="alert alert-danger" th:text="${mensajeError}"></div>

            <!-- FORM PRODUCTO -->
            <div class="card">
                <h3>Crear nuevo producto</h3>

                <form th:action="@{/admin/productos}" method="post"
                      th:object="${productoNuevo}">
                    <div class="form-grid">

                        <div class="form-group">
                            <label for="nombre">Nombre</label>
                            <input id="nombre"
                                   type="text"
                                   th:field="*{nombre}"
                                   placeholder="Ej: Hamburguesa Cl치sica">
                        </div>

                        <div class="form-group">
                            <label for="precio">Precio</label>
                            <input id="precio"
                                   type="number"
                                   min="0"
                                   step="0.01"
                                   th:field="*{precio}"
                                   placeholder="Ej: 250.00">
                        </div>

                        <div class="form-group">
                            <label for="tipo">Tipo</label>
                            <select id="tipo" th:field="*{tipo}">
                                <option value="" disabled selected>Seleccionar tipo</option>
                                <option value="H">Hamburguesa</option>
                                <option value="P">Pizza</option>
                                <option value="S">Salsa</option>
                                <option value="M">Masa</option>
                                <option value="QP">Queso de pizza</option>
                                <option value="C">Carne</option>
                                <option value="PH">Pan de hamburguesa</option>
                                <option value="A">Aderezo</option>
                                <option value="B">Bebida</option>
                                <option value="AC">Acompanamiento</option>
                            </select>
                        </div>

                    </div>

                    <br>
                    <button type="submit" class="btn-primary">Crear producto</button>
                </form>
            </div>

            <!-- TABLA PRODUCTOS + EDICI칍N MASIVA -->
            <div class="card">
                <h3>Listado de productos</h3>

                <form th:action="@{/admin/productos/guardar-cambios}" method="post">

                    <div class="table-responsive">
                        <table>
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Tipo</th>
                                <th>Precio</th>
                                <th>Activo</th>
                            </tr>
                            </thead>

                            <tbody>
                            <tr th:each="p : ${productos}">
                                <td th:text="${p.id_producto}"></td>

                                <td th:text="${p.nombre}"></td>

                                <td>
                                    <span class="badge-tipo"
                                          th:classappend="${p.tipo == 'H' ? ' badge-H' :
                                                           (p.tipo == 'P' ? ' badge-P' :
                                                           (p.tipo == 'B' ? ' badge-B' :
                                                           (p.tipo == 'AC' ? ' badge-AC' : ' badge-O')))} "
                                          th:text="${p.tipo}">
                                    </span>
                                </td>

                                <!-- PRECIO EDITABLE -->
                                <td>
                                    <input type="number"
                                           min="0"
                                           step="0.01"
                                           th:name="${'precio_' + p.id_producto}"
                                           th:value="${p.precio}"
                                           style="width:120px; padding:6px 8px; border-radius:8px; border:1px solid #ccc; text-align:right;">
                                </td>

                                <!-- ACTIVO -->
                                <td>
                                    <label class="switch">
                                        <input type="checkbox"
                                               name="activos"
                                               th:value="${p.id_producto}"
                                               th:checked="${p.activo}">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>

                            <tr th:if="${#lists.isEmpty(productos)}">
                                <td colspan="5" style="padding:18px;">
                                    No hay productos registrados.
                                </td>
                            </tr>

                            </tbody>
                        </table>
                    </div>

                    <br>
                    <button type="submit" class="btn-primary">Guardar cambios</button>
                </form>
            </div>

        </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 PizzUM & BurgUM. Todos los derechos reservados.</p>
            <p class="mb-0">Administra tu men칰 en un solo lugar 游꼣游꼢</p>
        </div>
    </footer>

</div>

<script>
    // Marca la pesta침a activa
    document.addEventListener('DOMContentLoaded', function () {
        const currentPath = window.location.pathname;
        document.querySelectorAll('.nav-link').forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
            }
        });
    });
</script>

</body>
</html>
