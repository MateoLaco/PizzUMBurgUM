<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Registro de Cliente - PizzUM & BurgUM</title>
    <style>
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #2c3e50;
            padding: 20px;
        }
        .container {
            max-width: 500px;
            width: 100%;
        }
        form {
            background: rgba(255,255,255,0.9);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        h2 {
            margin: 0 0 10px 0;
            text-align: center;
            color: #333;
        }
        label {
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 5px;
        }
        input, select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
        }
        .form-row {
            display: flex;
            gap: 15px;
        }
        .form-group {
            flex: 1;
        }
        .combo {
            display: flex;
            border: 1px solid #ccc;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(255,255,255,0.85);
        }
        .flag-select {
            border: none;
            background: transparent;
            padding: 10px;
            border-right: 1px solid #ccc;
            cursor: pointer;
            width: 80px;
        }
        .tel-input {
            border: none;
            flex: 1;
            padding: 10px;
            outline: none;
            background: transparent;
        }
        button {
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: #dc3545;
            color: white;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
        }
        button:hover { background: #9C2007; }
        .login-link {
            text-align: center;
            margin-top: 15px;
        }
        .login-link a {
            color: #2c3e50;
            text-decoration: none;
            font-weight: 600;
        }
        .login-link a:hover {
            text-decoration: underline;
        }
        .error {
            color: #dc3545;
            font-size: 0.9rem;
            text-align: center;
            padding: 10px;
            background: #ffe6e6;
            border-radius: 5px;
        }
        .password-feedback {
            font-size: 0.8rem;
            margin-top: 4px;
            padding-left: 5px;
            display: none;
        }
        .password-match {
            color: #28a745;
        }
        .password-mismatch {
            color: #dc3545;
        }
    </style>
</head>
<body>
<div class="container">
    <form method="POST" action="/auth/register" id="registerForm">
        <h2>Registro de Cliente</h2>

        <!-- Mensaje de error -->
        <div th:if="${error}" class="error" th:text="${error}"></div>

        <div>
            <label for="nombreUsuario">Nombre de Usuario</label>
            <input id="nombreUsuario" name="nombreUsuario" type="text" required />
        </div>

        <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" required />
        </div>

        <div>
            <label for="contrasena">Contraseña</label>
            <input id="contrasena" name="contrasena" type="password" required />
        </div>

        <!-- Nuevo campo para confirmar contraseña -->
        <div>
            <label for="confirmarContrasena">Confirmar Contraseña</label>
            <input id="confirmarContrasena" name="confirmarContrasena" type="password" required />
            <!-- Mensajes de coincidencia de contraseñas -->
            <div id="passwordMatchMessage" class="password-feedback password-match">
                ✓ Las contraseñas coinciden
            </div>
            <div id="passwordMismatchMessage" class="password-feedback password-mismatch">
                ✗ Las contraseñas no coinciden
            </div>
        </div>

        <div>
            <label for="metodoPago">Método de Pago</label>
            <select id="metodoPago" name="metodoPago" required>
                <option value="" disabled selected>Selecciona un tipo de tarjeta</option>
                <option value="Visa">Visa</option>
                <option value="MasterCard">MasterCard</option>
                <option value="American Express">American Express</option>
            </select>
        </div>

        <!-- Número de tarjeta (siempre visible) -->
        <div>
            <label for="numeroTarjeta">Número de Tarjeta</label>
            <input id="numeroTarjeta" name="numeroTarjeta" type="text" placeholder="1234 5678 9012 3456" required />
        </div>

        <div>
            <label for="direccion">Dirección</label>
            <input id="direccion" name="direccion" type="text" placeholder="Calle, número, ciudad" required />
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="diaNacimiento">Día de nacimiento</label>
                <select id="diaNacimiento" name="diaNacimiento" required>
                    <option value="" disabled selected>Día</option>
                    <!-- Días se llenan con JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <label for="mesNacimiento">Mes de nacimiento</label>
                <select id="mesNacimiento" name="mesNacimiento" required>
                    <option value="" disabled selected>Mes</option>
                    <option value="1">Enero</option>
                    <option value="2">Febrero</option>
                    <option value="3">Marzo</option>
                    <option value="4">Abril</option>
                    <option value="5">Mayo</option>
                    <option value="6">Junio</option>
                    <option value="7">Julio</option>
                    <option value="8">Agosto</option>
                    <option value="9">Septiembre</option>
                    <option value="10">Octubre</option>
                    <option value="11">Noviembre</option>
                    <option value="12">Diciembre</option>
                </select>
            </div>
            <div class="form-group">
                <label for="anioNacimiento">Año de Nacimiento</label>
                <select id="anioNacimiento" name="anioNacimiento" required>
                    <option value="" disabled selected>Año</option>
                    <!-- Años se llenan con JavaScript -->
                </select>
            </div>
        </div>

        <div>
            <label for="tel">Teléfono</label>
            <div class="combo">
                <select class="flag-select" id="codigoPais" name="codigoPais">
                    <option value="+34">ES +34</option>
                    <option value="+1">US +1</option>
                    <option value="+52">MX +52</option>
                    <option value="+54">AR +54</option>
                    <option value="+56">CL +56</option>
                    <option value="+57">CO +57</option>
                    <option value="+598">UY +598</option>
                </select>
                <input id="tel" name="tel" class="tel-input" type="text" placeholder="9 dígitos" required />
            </div>
        </div>

        <button type="submit" id="submitButton">Crear cuenta</button>

        <div class="login-link">
            <p>¿Ya tienes cuenta? <a href="/auth/login">Iniciar Sesión</a></p>
        </div>
    </form>
</div>

<script>
    // Llenar días del 1 al 31
    const diaSelect = document.getElementById('diaNacimiento');
    for (let i = 1; i <= 31; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        diaSelect.appendChild(option);
    }

    // Llenar años desde 1920 hasta el año actual
    const anioSelect = document.getElementById('anioNacimiento');
    const currentYear = new Date().getFullYear();
    for (let i = currentYear; i >= 1920; i--) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        anioSelect.appendChild(option);
    }

    // Verificar si las contraseñas coinciden
    const contrasenaInput = document.getElementById('contrasena');
    const confirmarContrasenaInput = document.getElementById('confirmarContrasena');
    const passwordMatchMessage = document.getElementById('passwordMatchMessage');
    const passwordMismatchMessage = document.getElementById('passwordMismatchMessage');
    const submitButton = document.getElementById('submitButton');
    const registerForm = document.getElementById('registerForm');

    function verificarContrasenas() {
        const contrasena = contrasenaInput.value;
        const confirmarContrasena = confirmarContrasenaInput.value;

        // Ocultar ambos mensajes si ambos campos están vacíos
        if (contrasena === '' && confirmarContrasena === '') {
            passwordMatchMessage.style.display = 'none';
            passwordMismatchMessage.style.display = 'none';
            return;
        }

        // Mostrar mensaje de coincidencia o no coincidencia
        if (contrasena === confirmarContrasena && contrasena !== '') {
            passwordMatchMessage.style.display = 'block';
            passwordMismatchMessage.style.display = 'none';
        } else {
            passwordMatchMessage.style.display = 'none';
            passwordMismatchMessage.style.display = 'block';
        }
    }

    // Agregar event listeners para verificar las contraseñas en tiempo real
    contrasenaInput.addEventListener('input', verificarContrasenas);
    confirmarContrasenaInput.addEventListener('input', verificarContrasenas);

    // Prevenir envío del formulario si las contraseñas no coinciden
    registerForm.addEventListener('submit', function(event) {
        const contrasena = contrasenaInput.value;
        const confirmarContrasena = confirmarContrasenaInput.value;

        if (contrasena !== confirmarContrasena) {
            event.preventDefault();
            alert('Las contraseñas no coinciden. Por favor, verifica que ambas contraseñas sean iguales.');
            confirmarContrasenaInput.focus();
        }
    });
</script>
</body>
</html>